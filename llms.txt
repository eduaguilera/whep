# Who Has Eaten the Planet

## Project

#### **Who Has Eaten the Planet? The paths of food systems beyond the safe and just operating space (1850-2020)**

Food production covers the most basic human need, and simultaneously is
the main driver of anthropogenic environmental impacts. These impacts
have resulted in the transgression, during the brief period since the
industrial revolution, of the planetary boundaries defining the safe
operating space of humanity. A rich research literature quantifies the
last 60 years’ fast, heterogeneous, and often unfair development in food
supply and related environmental impacts, and how these depend on
agro-climatic factors, technology, and trade flows, all of which have
greatly changed but with different trajectories around the world.
However, these developments lack an integrated approach, and are very
poorly quantified before 1961. WHEP will bridge these knowledge gaps,
assessing “who has eaten the planet” by answering the questions:

> What are the environmental impacts of food production since 1850?

> What is the role of trade in food supply and in displacing the
> responsibilities for these impacts?

> How are impacts related to planetary boundaries, food supply and
> inequality?

These highly ambitious goals are addressed by four objectives:

1.  Constructing a consolidated global country-level annual database on
    agricultural production and management, using massive data collation
    in combination with modeling.
2.  Estimating the environmental impacts: greenhouse gas emissions and
    carbon, land, water, nitrogen, and phosphorus through spatially
    explicit, integrated, dynamic modeling.
3.  Calculating product footprints and tracing them along international
    trade chains.
4.  Analyzing the observed trajectories in the safe and just operating
    space, by assessing the drivers, and how impacts at the production
    and consumption levels are related to fair and healthy supply. This
    ground-breaking research will shed new light on the environmental
    history of food, opening up many new research frontiers, and
    providing necessary information to design fair and sustainable
    policies.

You can also visit the [European project
site](https://cordis.europa.eu/project/id/101115126).

## R package

The WHEP project heavily relies on data. We use the R programming
language. This repository is built as an R package containing
functionality that we think might be useful to share to others as part
of the project. This will also include functions for easily downloading
the data gathered by the project.

## Installation

The package is under constant development. Initial stable releases are
available from both CRAN and
[R-universe](https://eduaguilera.r-universe.dev/whep).

You can install the stable version on CRAN:

``` r
install.packages('whep')
```

If you want the development version of `whep`, you can:

``` r
# Install from GitHub
pak::pak("eduaguilera/whep")

# Install from R-universe
install.packages(
  "whep",
  repos = c("https://eduaguilera.r-universe.dev", "https://cloud.r-project.org")
)
```

## Usage

You can read more about the package’s functionalities from the
documentation at the [reference
page](https://eduaguilera.github.io/whep/reference/index.html).

## Contributing

We try to follow best coding practices, specifically focused on R
package creation. The process is roughly summarized in:

- Use git. Work on your own branch.
- Track dependencies using `renv` R package.
- Add your new functionality inside `R/` directory as functions.
- Add function documentation.
- Write clean code. Follow [Tidyverse style
  guide](https://style.tidyverse.org/).
- Write tests for your code.
- Create pull requests. Ask for review.

The project is starting with **contributors** that are still learning
about coding and best practices. For this reason, if you’re
**inexperienced**, we have written a **small free online book**
explaining most of the things you need from the previous steps, covering
both git and R package development. You can directly **access it
[here](https://lbm364dl.github.io/follow-the-workflow/)**. Anyone is
welcome to contribute, but we highly recommend to go through this guide
to become familiar with the workflow if you are still not used to it.

# Package index

## Tidy datasets

Get cleaned dataframes with project related data.

- [`build_supply_use()`](https://eduaguilera.github.io/whep/reference/build_supply_use.md)
  : Supply and use tables
- [`get_bilateral_trade()`](https://eduaguilera.github.io/whep/reference/get_bilateral_trade.md)
  : Bilateral trade data
- [`get_feed_intake()`](https://eduaguilera.github.io/whep/reference/get_feed_intake.md)
  : Livestock feed intake
- [`get_primary_production()`](https://eduaguilera.github.io/whep/reference/get_primary_production.md)
  : Primary items production
- [`get_primary_residues()`](https://eduaguilera.github.io/whep/reference/get_primary_residues.md)
  : Crop residue items
- [`get_processing_coefs()`](https://eduaguilera.github.io/whep/reference/get_processing_coefs.md)
  : Processed products share factors
- [`get_wide_cbs()`](https://eduaguilera.github.io/whep/reference/get_wide_cbs.md)
  : Commodity balance sheet data

## Download large input datasets

Fetch large files from external sources and cache them.

- [`whep_read_file()`](https://eduaguilera.github.io/whep/reference/whep_read_file.md)
  : Download, cache and read files
- [`whep_inputs`](https://eduaguilera.github.io/whep/reference/whep_inputs.md)
  : External inputs
- [`whep_list_file_versions()`](https://eduaguilera.github.io/whep/reference/whep_list_file_versions.md)
  : Input file versions

## Code namings

Add name columns in dataframes from their codes or viceversa.

### Polities

- [`polities`](https://eduaguilera.github.io/whep/reference/polities.md)
  : Polities
- [`add_area_code()`](https://eduaguilera.github.io/whep/reference/add_area_code.md)
  : Get area codes from area names
- [`add_area_name()`](https://eduaguilera.github.io/whep/reference/add_area_name.md)
  : Get area names from area codes

### Commodity balance sheet items

- [`items_cbs`](https://eduaguilera.github.io/whep/reference/items_cbs.md)
  : Commodity balance sheet items
- [`add_item_cbs_code()`](https://eduaguilera.github.io/whep/reference/add_item_cbs_code.md)
  : Get commodity balance sheet item codes from item names
- [`add_item_cbs_name()`](https://eduaguilera.github.io/whep/reference/add_item_cbs_name.md)
  : Get commodity balance sheet item names from item codes

### Primary production items

- [`items_prod`](https://eduaguilera.github.io/whep/reference/items_prod.md)
  : Primary production items
- [`add_item_prod_code()`](https://eduaguilera.github.io/whep/reference/add_item_prod_code.md)
  : Get production item codes from item names
- [`add_item_prod_name()`](https://eduaguilera.github.io/whep/reference/add_item_prod_name.md)
  : Get production item names from item codes

## FAOSTAT raw data

Download FAOSTAT data as is.

- [`get_faostat_data()`](https://eduaguilera.github.io/whep/reference/get_faostat_data.md)
  : Scrapes activity_data from FAOSTAT and slightly post-processes it

## Data sources

Get a tidy dataframe with the found sources for different data.

- [`expand_trade_sources()`](https://eduaguilera.github.io/whep/reference/expand_trade_sources.md)
  : Trade data sources

## Nitrogen cycles Spain

Functions to generate data for N inputs, outputs, production, destinies

- [`create_n_prov_destiny()`](https://eduaguilera.github.io/whep/reference/create_n_prov_destiny.md)
  : GRAFS Nitrogen (N) flows
- [`create_n_soil_inputs()`](https://eduaguilera.github.io/whep/reference/create_n_soil_inputs.md)
  : Nitrogen (N) soil inputs for Spain ———————————-
- [`create_n_production()`](https://eduaguilera.github.io/whep/reference/create_n_production.md)
  : N production for Spain ———————————————–
- [`calculate_nue_crops()`](https://eduaguilera.github.io/whep/reference/calculate_nue_crops.md)
  : N soil inputs and Nitrogen Use Efficiency (NUE) for crop ————-
- [`calculate_nue_livestock()`](https://eduaguilera.github.io/whep/reference/calculate_nue_livestock.md)
  : NUE for Livestock —————————————————-
- [`calculate_system_nue()`](https://eduaguilera.github.io/whep/reference/calculate_system_nue.md)
  : System NUE ———————————————————–
- [`create_n_nat_destiny()`](https://eduaguilera.github.io/whep/reference/create_n_nat_destiny.md)
  : GRAFS Nitrogen (N) flows – National Spain

## Gap filling functions

Functions to fill gaps (NA values) in time-dependent variables using
different methods.

- [`linear_fill()`](https://eduaguilera.github.io/whep/reference/linear_fill.md)
  : Fill gaps by linear interpolation, or carrying forward or backward.
- [`proxy_fill()`](https://eduaguilera.github.io/whep/reference/proxy_fill.md)
  : Fill gaps using a proxy variable
- [`sum_fill()`](https://eduaguilera.github.io/whep/reference/sum_fill.md)
  : Fill gaps summing the previous value of a variable to the value of
  another variable.

# Articles

### All vignettes

- [Trade sources year
  coverage](https://eduaguilera.github.io/whep/articles/trade-sources-coverage.md):
